"use strict";(self["webpackChunkmetawall"]=self["webpackChunkmetawall"]||[]).push([[566],{8566:function(e,s,a){a.r(s),a.d(s,{default:function(){return j}});var t=a(3396),o=a(7139),r=a(9242);const l=e=>((0,t.dD)("data-v-3d879ac3"),e=e(),(0,t.Cn)(),e),d={class:"account"},n={class:"user-photo border circle"},m=["src"],i={class:"upload-wrapper"},u={for:"uploadImage",class:"upload btn radius"},c=(0,t.Uk)(" 上傳大頭照 "),p=l((()=>(0,t._)("div",{class:"error-message"},"圖片格式錯誤，僅限 JPG、PNG 圖片",-1))),h={key:0,class:"error-message"},g={for:"name",class:"name-wrapper"},b=l((()=>(0,t._)("div",{class:"title"},"暱稱",-1))),w={class:"sex-wrapper"},f=l((()=>(0,t._)("div",{class:"title"},"性別",-1))),_={for:"male",class:"radio-wrapper"},v=l((()=>(0,t._)("span",{class:"radio-button"},null,-1))),x=(0,t.Uk)(" 男性 "),k={for:"female",class:"radio-wrapper"},I=l((()=>(0,t._)("span",{class:"radio-button"},null,-1))),U=(0,t.Uk)(" 女性 "),$=["disabled"];function y(e,s,a,l,y,L){const V=(0,t.up)("VField"),C=(0,t.up)("error-message"),j=(0,t.up)("VForm");return(0,t.wg)(),(0,t.iD)("div",d,[(0,t.Wm)(j,{onSubmit:L.updated},{default:(0,t.w5)((({errors:a})=>[(0,t._)("div",n,[(0,t._)("img",{onLoad:s[0]||(s[0]=(...s)=>e.successLoadImg&&e.successLoadImg(...s)),src:y.user.photo,alt:"",class:"hide"},null,40,m)]),(0,t._)("div",i,[(0,t._)("label",u,[c,(0,t.Wm)(V,{id:"uploadImage",name:"uploadImage",type:"file",class:"hide",onChange:e=>L.upload(a),rules:{ext:["jpg","png","jpeg"]}},null,8,["onChange"])]),(0,t.Wm)(C,{name:"uploadImage"},{default:(0,t.w5)((()=>[p])),_:1}),y.errMessage?((0,t.wg)(),(0,t.iD)("div",h,(0,o.zw)(y.errMessage),1)):(0,t.kq)("",!0)]),(0,t._)("label",g,[b,(0,t.Wm)(V,{id:"name",name:"暱稱",modelValue:y.user.name,"onUpdate:modelValue":s[1]||(s[1]=e=>y.user.name=e),placeholder:"輸入您的暱稱",class:"name border",rules:{required:!0,min:2,max:13}},null,8,["modelValue"]),(0,t.Wm)(C,{class:"error-message",name:"暱稱"})]),(0,t._)("div",w,[f,(0,t._)("label",_,[(0,t.wy)((0,t._)("input",{type:"radio",id:"male","onUpdate:modelValue":s[2]||(s[2]=e=>y.user.sex=e),value:"male",class:"radio"},null,512),[[r.G2,y.user.sex]]),v,x]),(0,t._)("label",k,[(0,t.wy)((0,t._)("input",{type:"radio",id:"female","onUpdate:modelValue":s[3]||(s[3]=e=>y.user.sex=e),value:"female",class:"radio"},null,512),[[r.G2,y.user.sex]]),I,U])]),(0,t._)("button",{type:"submit",class:"btn border submit",disabled:L.disabled(a)},"送出更新",8,$)])),_:1},8,["onSubmit"])])}a(6699);var L={name:"AccountView",data(){return{user:{photo:"",name:"",sex:""},errMessage:""}},computed:{tempUser(){const{user:e}=this.$store.state;return e},compare(){const{tempUser:e}=this,{user:s}=this,a=[s.photo!==e.photo,s.name!==e.name,s.sex!==e.sex].includes(!0);return a}},watch:{tempUser:{handler(){const e=this.tempUser;this.user={photo:e.photo,name:e.name,sex:e.sex||"male"}},deep:!0,immediate:!0}},methods:{async upload(e){if(this.errMessage="",void 0===e.uploadImage){this.$store.commit("Load",!0);const e=document.getElementById("uploadImage").files[0],s=new FormData;s.append("file-to-upload",e);const a="https://metawall-backend-c89d.onrender.com/upload/avatar",{headers:t}=this.$store.state;this.$http.post(a,s,t).then((e=>{const{imgUrl:s}=e.data;this.user.photo=s})).catch((e=>{this.errMessage=e.response.data.message})).then((()=>{this.$store.commit("Load",!1)}))}},updated(){this.$store.commit("Load",!0);const e="https://metawall-backend-c89d.onrender.com/user/profile",{headers:s}=this.$store.state,a={},{tempUser:t}=this,o=this.user;o.name!==t.name&&(a.name=o.name),o.photo!==t.photo&&"https://i.imgur.com/IZLtAAb.jpg"!==o.photo&&(a.photo=o.photo),o.sex!==t.sex&&(a.sex=o.sex),this.$http.patch(e,a,s).then((e=>{const{user:s}=e.data;delete s.followers,delete s.following,""===s.photo&&(s.photo="https://i.imgur.com/IZLtAAb.jpg"),this.$store.commit("user",s),this.$swal({title:"資料已更新",icon:"success",customClass:{actions:"customize",icon:"customize"}})})).catch((e=>{console.error(e)})).then((()=>{this.$store.commit("Load",!1)}))},disabled(e){const s=Object.keys(e).length;return!this.user.name||0!==s||!this.compare}}},V=a(89);const C=(0,V.Z)(L,[["render",y],["__scopeId","data-v-3d879ac3"]]);var j=C}}]);
//# sourceMappingURL=566.822e4651.js.map