"use strict";(self["webpackChunkmetawall"]=self["webpackChunkmetawall"]||[]).push([[176],{7176:function(e,s,a){a.r(s),a.d(s,{default:function(){return j}});var t=a(6768),o=a(4232),r=a(5130);const l=e=>((0,t.Qi)("data-v-aa62ae98"),e=e(),(0,t.jt)(),e),n={class:"account"},d={class:"user-photo border circle"},i=["src"],m={class:"upload-wrapper"},u={class:"upload btn radius",for:"uploadImage"},c=(0,t.eW)(" 上傳大頭照 "),p=l((()=>(0,t.Lk)("div",{class:"error-message"},"圖片格式錯誤，僅限 JPG、PNG 圖片",-1))),h={key:0,class:"error-message"},g={class:"name-wrapper",for:"name"},b=l((()=>(0,t.Lk)("div",{class:"title"},"暱稱",-1))),L={class:"sex-wrapper"},k=l((()=>(0,t.Lk)("div",{class:"title"},"性別",-1))),f={class:"radio-wrapper",for:"male"},v=l((()=>(0,t.Lk)("span",{class:"radio-button"},null,-1))),w=(0,t.eW)(" 男性 "),x={class:"radio-wrapper",for:"female"},I=l((()=>(0,t.Lk)("span",{class:"radio-button"},null,-1))),$=(0,t.eW)(" 女性 "),U=["disabled"];function y(e,s,a,l,y,F){const V=(0,t.g2)("VField"),C=(0,t.g2)("error-message"),j=(0,t.g2)("VForm");return(0,t.uX)(),(0,t.CE)("div",n,[(0,t.bF)(j,{onSubmit:F.updated},{default:(0,t.k6)((({errors:a})=>[(0,t.Lk)("div",d,[(0,t.Lk)("img",{class:"hide",src:y.user.photo,alt:"",onLoad:s[0]||(s[0]=(...s)=>e.successLoadImg&&e.successLoadImg(...s))},null,40,i)]),(0,t.Lk)("div",m,[(0,t.Lk)("label",u,[c,(0,t.bF)(V,{id:"uploadImage",class:"hide",name:"uploadImage",type:"file",rules:{ext:["jpg","png","jpeg"]},onChange:e=>F.upload(a)},null,8,["onChange"])]),(0,t.bF)(C,{name:"uploadImage"},{default:(0,t.k6)((()=>[p])),_:1}),y.errMessage?((0,t.uX)(),(0,t.CE)("div",h,(0,o.v_)(y.errMessage),1)):(0,t.Q3)("",!0)]),(0,t.Lk)("label",g,[b,(0,t.bF)(V,{id:"name",modelValue:y.user.name,"onUpdate:modelValue":s[1]||(s[1]=e=>y.user.name=e),class:"name border",name:"暱稱",placeholder:"輸入您的暱稱",rules:{required:!0,min:2,max:13}},null,8,["modelValue"]),(0,t.bF)(C,{class:"error-message",name:"暱稱"})]),(0,t.Lk)("div",L,[k,(0,t.Lk)("label",f,[(0,t.bo)((0,t.Lk)("input",{id:"male","onUpdate:modelValue":s[2]||(s[2]=e=>y.user.sex=e),class:"radio",type:"radio",value:"male"},null,512),[[r.XL,y.user.sex]]),v,w]),(0,t.Lk)("label",x,[(0,t.bo)((0,t.Lk)("input",{id:"female","onUpdate:modelValue":s[3]||(s[3]=e=>y.user.sex=e),class:"radio",type:"radio",value:"female"},null,512),[[r.XL,y.user.sex]]),I,$])]),(0,t.Lk)("button",{class:"btn border submit",type:"submit",disabled:F.disabled(a)},"送出更新",8,U)])),_:1},8,["onSubmit"])])}var F={name:"AccountView",data(){return{user:{photo:"",name:"",sex:""},errMessage:""}},computed:{tempUser(){const{user:e}=this.$store.state;return e},compare(){const{tempUser:e}=this,{user:s}=this,a=[s.photo!==e.photo,s.name!==e.name,s.sex!==e.sex].includes(!0);return a}},watch:{tempUser:{handler(){const e=this.tempUser;this.user={photo:e.photo,name:e.name,sex:e.sex||"male"}},deep:!0,immediate:!0}},methods:{async upload(e){if(this.errMessage="",void 0===e.uploadImage){this.$store.commit("Load",!0);const e=document.getElementById("uploadImage").files[0],s=new FormData;s.append("file-to-upload",e);const a="https://metawall-backend-c89d.onrender.com/upload/avatar",{headers:t}=this.$store.state;this.$http.post(a,s,t).then((e=>{const{imgUrl:s}=e.data;this.user.photo=s})).catch((e=>{this.errMessage=e.response.data.message})).then((()=>{this.$store.commit("Load",!1)}))}},updated(){this.$store.commit("Load",!0);const e="https://metawall-backend-c89d.onrender.com/user/profile",{headers:s}=this.$store.state,a={},{tempUser:t}=this,o=this.user;o.name!==t.name&&(a.name=o.name),o.photo!==t.photo&&"https://i.imgur.com/IZLtAAb.jpg"!==o.photo&&(a.photo=o.photo),o.sex!==t.sex&&(a.sex=o.sex),this.$http.patch(e,a,s).then((e=>{const{user:s}=e.data;delete s.followers,delete s.following,""===s.photo&&(s.photo="https://i.imgur.com/IZLtAAb.jpg"),this.$store.commit("user",s),this.$swal({title:"資料已更新",icon:"success",customClass:{actions:"customize",icon:"customize"}})})).catch((e=>{console.error(e)})).then((()=>{this.$store.commit("Load",!1)}))},disabled(e){const s=Object.keys(e).length;return!this.user.name||0!==s||!this.compare}}},V=a(1241);const C=(0,V.A)(F,[["render",y],["__scopeId","data-v-aa62ae98"]]);var j=C}}]);
//# sourceMappingURL=176.8abd3e74.js.map