"use strict";(self["webpackChunkmetawall"]=self["webpackChunkmetawall"]||[]).push([[547],{8132:function(e,t,s){s.d(t,{A:function(){return p}});var a=s(6768),o=s(4232);const r=e=>((0,a.Qi)("data-v-32e32aff"),e=e(),(0,a.jt)(),e),n={class:"title"},i={class:"border bg-white"},d=r((()=>(0,a.Lk)("div",{class:"mat border bg-white"},null,-1)));function l(e,t,s,r,l,c){return(0,a.uX)(),(0,a.CE)("div",n,[(0,a.Lk)("h1",i,(0,o.v_)(s.title),1),d])}var c={name:"TitleCMPT",props:["title"]},m=s(1241);const u=(0,m.A)(c,[["render",l],["__scopeId","data-v-32e32aff"]]);var p=u},3547:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});var a=s(6768),o=s(4232);const r=e=>((0,a.Qi)("data-v-a06d3cd8"),e=e(),(0,a.jt)(),e),n={class:"post"},i={class:"content-wrapper",for:"content"},d=(0,a.eW)("貼文內容 "),l={class:"btn upload",for:"uploadImage"},c=(0,a.eW)(" 上傳圖片 "),m={class:"image-wrapper border radius"},u={key:0,class:"cover border cursor-none radius"},p=r((()=>(0,a.Lk)("span",{class:"material-icons"}," image ",-1))),h=[p],g=["src"],b=r((()=>(0,a.Lk)("span",{class:"material-icons"}," close ",-1))),f=[b],k=r((()=>(0,a.Lk)("div",{class:"error-message"},"圖片格式錯誤，僅限 JPG、PNG 圖片",-1))),v={key:0,class:"error-message"},L={class:"submit-wrapper"},w=["disabled"];function $(e,t,s,r,p,b){const $=(0,a.g2)("Title"),I=(0,a.g2)("VField"),C=(0,a.g2)("error-message"),y=(0,a.g2)("VForm");return(0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)($,{title:"張貼動態"}),(0,a.bF)(y,{class:"border bg-white radius",onSubmit:b.createPosts},{default:(0,a.k6)((({errors:s})=>[(0,a.Lk)("label",i,[d,(0,a.bF)(I,{id:"content",modelValue:p.content,"onUpdate:modelValue":t[0]||(t[0]=e=>p.content=e),class:"content border",name:"內容",placeholder:"輸入您的貼文內容",as:"textarea",rules:"required"},null,8,["modelValue"]),(0,a.bF)(C,{name:"內容"})]),(0,a.Lk)("label",l,[c,(0,a.bF)(I,{id:"uploadImage",class:"hide",name:"uploadImage",type:"file",rules:{ext:["jpg","png","jpeg"]},onChange:e=>b.upload(s)},null,8,["onChange"])]),(0,a.Lk)("div",m,[(0,a.Lk)("div",{class:"clamp",style:(0,o.Tr)(p.paddingBottom)},[p.image?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",u,h)),p.image?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("img",{ref:"postsPhoto",class:"hide",src:p.image,alt:"",onLoad:t[1]||(t[1]=t=>(e.successLoadImg,b.size()))},null,40,g),(0,a.Lk)("button",{class:"btn border clear circle",type:"button",onClick:t[2]||(t[2]=(...e)=>b.clearImg&&b.clearImg(...e))},f)],64)):(0,a.Q3)("",!0)],4)]),(0,a.bF)(C,{name:"uploadImage"},{default:(0,a.k6)((()=>[k])),_:1}),p.errMessage?((0,a.uX)(),(0,a.CE)("div",v,(0,o.v_)(p.errMessage),1)):(0,a.Q3)("",!0),(0,a.Lk)("div",L,[(0,a.Lk)("button",{class:"btn border submit",type:"submit",disabled:b.disabled(s)}," 送出貼文 ",8,w)])])),_:1},8,["onSubmit"])])}var I=s(8132),C={name:"PostView",components:{Title:I.A},data(){return{content:"",image:"",err:!0,errMessage:"",paddingBottom:{}}},methods:{createPosts(){this.$store.commit("Load",!0);const e="https://metawall-backend-c89d.onrender.com/post",{headers:t}=this.$store.state,s={user:this.$store.state.user._id,image:this.image,content:this.content};this.$http.post(e,s,t).then((()=>{this.$router.push({name:"posts_wall"})})).catch((e=>{console.error(e)})).then((()=>{this.$store.commit("Load",!1)}))},async upload(e){if(this.errMessage="",this.image="",void 0===e.uploadImage){this.$store.commit("Load",!0);const e=document.getElementById("uploadImage").files[0],t=new FormData;t.append("file-to-upload",e);const s="https://metawall-backend-c89d.onrender.com/upload/post",{headers:a}=this.$store.state;this.$http.post(s,t,a).then((e=>{const{imgUrl:t}=e.data;this.image=t})).catch((e=>{this.errMessage=e.response.data.message})).then((()=>{this.$store.commit("Load",!1)}))}},clearImg(){this.image="",this.paddingBottom={paddingBottom:"52.35%"}},disabled(e){const t=Object.keys(e).length;return!this.content||0!==t},size(){if(this.$refs.postsPhoto){const{height:e}=this.$refs.postsPhoto,{width:t}=this.$refs.postsPhoto,s=e/t*100;this.paddingBottom={paddingBottom:s>150?"150%":`${s}%`}}}}},y=s(1241);const F=(0,y.A)(C,[["render",$],["__scopeId","data-v-a06d3cd8"]]);var P=F}}]);
//# sourceMappingURL=547.bb0069b8.js.map